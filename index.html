<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inesh Kumar — Journey</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 24px;
    }

    .card {
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 24px;
      max-width: 1100px;
      width: 100%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.45);
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    /* Left news panel */
    .news {
      width: 260px;
      min-width: 220px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 14px;
      border: 1px solid rgba(255,255,255,0.04);
    }

    .profile-photo { display:block; width:84px; height:84px; border-radius:50%; object-fit:cover; margin:6px auto 12px; border:2px solid rgba(255,255,255,0.06); }
    .news-name { text-align:center; font-weight:700; margin-bottom:8px; }

    .news h3 { margin: 0 0 8px; font-size: 1.05rem; }
    .news-item { font-size: 0.92rem; color: #d7e3ee; margin-bottom: 10px; }
    .news-item small { display:block; color:#9fb0bf; margin-top:4px; }
    .news .news-content { margin-top:8px; background: rgba(255,255,255,0.02); padding:10px; border-radius:8px; color:#d7e3ee; font-size:0.92rem; }
    .news .news-content img { max-width:100%; height:auto; display:block; margin:8px 0; border-radius:6px; }

    /* Main content area */
    .main { flex:1; }

    header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom: 12px;
    }

    h1 { margin: 0; font-size: 1.4rem; }
    .intro { color: #d0d7de; margin-top:6px; margin-bottom: 6px; }

    .links a { display:inline-block; margin-left:10px; padding:6px 10px; border-radius:999px; text-decoration:none; color:#fff; border:1px solid rgba(255,255,255,0.12); font-size:0.88rem; }
    .links a:hover { background:#fff; color:#0f2027; }

    /* Ensure links are shown in a row and aligned */
    .links { display:flex; gap:8px; align-items:center; }
    .links a { margin-left:0; }

    /* Journey timeline */
    .year-group { margin-bottom: 12px; border-radius:8px; overflow:hidden; }
    .year-header { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 12px; background: rgba(255,255,255,0.02); cursor:pointer; border:1px solid rgba(255,255,255,0.02); }
    .year-header:hover { background: rgba(255,255,255,0.03); }
    .year-title { font-size:1.05rem; font-weight:700; }
    .toggle-indicator { transition: transform 0.18s ease; color:#aab2bd; }
    .year-group.open .toggle-indicator { transform: rotate(180deg); }

    .posts { display:none; padding:10px 12px 12px 12px; }
    .year-group.open .posts { display:block; }

    .post-item { background: rgba(255,255,255,0.03); padding:10px 12px; border-radius:8px; margin-top:8px; cursor:pointer; border:1px solid rgba(255,255,255,0.03); }
    .post-item:hover { transform: translateY(-3px); background: rgba(255,255,255,0.035); }
    .post-title { font-weight:600; }
    .post-summary { color:#bfcbd6; font-size:0.92rem; margin-top:6px; }

    footer { margin-top: 10px; font-size: 0.85rem; color: #aab2bd; text-align:center; }

    /* Modal styles */
    .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.6); z-index: 50; padding: 20px; }
    .modal.open { display:flex; }
    .modal-card { background:#0f1720; color:#e6eef6; max-width:860px; width:100%; max-height:86vh; overflow:auto; border-radius:12px; padding:18px; box-shadow:0 12px 40px rgba(0,0,0,0.6); }
    .modal-header { display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .close-btn { background:transparent; border:1px solid rgba(255,255,255,0.08); color:#fff; padding:6px 10px; border-radius:8px; cursor:pointer; }

    /* README preview styling (scoped inside modal) */
    .readme-wrapper { background: #ffffff; color: #0f1720; border-radius: 8px; padding: 16px; line-height: 1.6; }
    .readme-wrapper h1, .readme-wrapper h2, .readme-wrapper h3 { color: #0b2540; font-weight:800; }
    .readme-wrapper h1 { font-size: 1.8rem; margin-top: 0; }
    .readme-wrapper h2 { font-size: 1.4rem; }
    .readme-wrapper p { color: #123; }
    .readme-wrapper img { max-width: 100%; height: auto; border-radius:6px; margin:10px 0; display:block; }
    .readme-wrapper pre { background:#f3f4f6; color:#111; padding:10px; border-radius:6px; overflow:auto; }
    .readme-wrapper code { background:#f3f4f6; color:#111; padding:2px 6px; border-radius:4px; }

    @media (max-width:900px){
      .card { flex-direction:column; }
      .news { width:100%; }
    }
  </style>
</head>
<body>
  <div class="card">
    <aside class="news" aria-label="Latest news">
      <!-- Profile photo and quick links -->
      <img src="Inesh_kumar.jpeg" alt="Inesh Kumar" class="profile-photo" />
      <div class="news-name">Inesh Kumar</div>
      <div class="profile-links">
        <a href="inesh_resume.pdf" target="_blank">Resume</a>
        <a href="https://www.linkedin.com/in/inesh-kumar-50b170167/" target="_blank">LinkedIn</a>
      </div>
      <!-- latest-updates README will be loaded here by script -->
    </aside>

    <main class="main">
      <header>
        <div>
          <h1>A chronological collection of short posts describing real issues, how they were diagnosed and resolved</h1>
         </div>
       </header>

      <section id="journey">
        <!-- Year groups rendered by script -->
      </section>

      <footer>
        © <span id="year"></span> Inesh Kumar
      </footer>
    </main>
  </div>

  <!-- Modal: view post -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-header">
        <strong id="modal-title">Post</strong>
        <div>
          <button id="open-full" class="close-btn" style="margin-right:8px;">Open full page</button>
          <button id="close-modal" class="close-btn">Close</button>
        </div>
      </div>
      <div id="modal-body" style="margin-top:12px;">
        <div style="color:#aab2bd; font-size:0.9rem; margin-bottom:8px;" id="view-meta"></div>
        <div id="view-content"></div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // We'll display topics from year-drafts/2026. Create an index file at year-drafts/2026/index.json listing the markdown files to show.
    const SITE_YEAR = '2026';

    // load a markdown file and return text (works when served over HTTP)
    async function loadMarkdown(path){
      const res = await fetch(path);
      if(!res.ok) throw new Error('not found');
      return res.text();
    }

    // Render a single year (SITE_YEAR) and list markdown files defined in year-drafts/SITE_YEAR/index.json.
    async function renderJourney(){
      const container = document.getElementById('journey');
      container.innerHTML = '';
      const year = SITE_YEAR;
      const grp = document.createElement('div');
      grp.className = 'year-group';
      grp.innerHTML = `<div class="year-header" role="button" aria-expanded="false"><div class="year-title">${year}</div><div class="toggle-indicator">▾</div></div>`;
      const postsContainer = document.createElement('div');
      postsContainer.className = 'posts';

      // Try to load index.json which lists files to display
      const indexPath = `./year-drafts/${year}/index.json`;
      try{
        const idxText = await loadMarkdown(indexPath); // it's JSON
        const idx = JSON.parse(idxText);
        if(Array.isArray(idx)){
          idx.forEach(entry => {
            const item = document.createElement('div');
            item.className = 'post-item';
            item.setAttribute('tabindex','0');
            const title = entry.title || entry.file || 'Untitled';
            const summary = entry.summary || (entry.date ? entry.date : '');
            item.innerHTML = `<div class="post-title">${escapeHtml(title)}</div><div class="post-summary">${escapeHtml(summary)}</div>`;
            item.addEventListener('click', async ()=>{
              const path = `./year-drafts/${year}/${entry.file}`;
              try{
                let md = await loadMarkdown(path);
                md = normalizeRelativeLinks(md, `./year-drafts/${year}`);
                currentPreviewMarkdown = md;
                document.getElementById('modal-title').textContent = title;
                document.getElementById('view-meta').textContent = entry.date ? `${entry.date} — ${entry.summary || ''}` : '';
                document.getElementById('view-content').innerHTML = '<div class="readme-wrapper">' + markdownToHtml(md || '') + '</div>';
                document.getElementById('modal').classList.add('open');
              }catch(e){
                alert('Failed to load file: ' + path + '\n' + e.message);
              }
            });
            item.addEventListener('keypress', (e)=>{ if(e.key === 'Enter') item.click(); });
            postsContainer.appendChild(item);
          });
        }
      }catch(e){
        // fallback: try to show README.md (if available) or provide hint about running a local server
        try{
          const md = await loadMarkdown(`./year-drafts/${year}/README.md`);
          const draftItem = document.createElement('div');
          draftItem.className = 'post-item';
          draftItem.setAttribute('tabindex','0');
          draftItem.innerHTML = `<div class="post-title">${year} — Drafts</div><div class="post-summary">Open year README</div>`;
          draftItem.addEventListener('click', ()=>{
            currentPreviewMarkdown = md;
            document.getElementById('modal-title').textContent = `${year} — Drafts`;
            document.getElementById('view-meta').textContent = '';
            document.getElementById('view-content').innerHTML = '<div class="readme-wrapper">' + markdownToHtml(md || '') + '</div>';
            document.getElementById('modal').classList.add('open');
          });
          postsContainer.appendChild(draftItem);
        }catch(_){
          const hint = document.createElement('div');
          hint.className = 'post-item';
          hint.style.opacity = '0.9';
          hint.innerHTML = `<div class="post-title">Drafts available in repository</div><div class="post-summary">To preview individual files, add an index.json in year-drafts/${year} listing markdown files, and serve the site over HTTP (e.g. python3 -m http.server).</div>`;
          postsContainer.appendChild(hint);
        }
      }

      grp.appendChild(postsContainer);
      // open by default
      grp.classList.add('open');
      grp.querySelector('.year-header').setAttribute('aria-expanded','true');
      grp.querySelector('.year-header').addEventListener('click', ()=>{
        const open = grp.classList.toggle('open');
        grp.querySelector('.year-header').setAttribute('aria-expanded', open ? 'true' : 'false');
      });
      container.appendChild(grp);
    }

    // track the currently-loaded markdown shown in the modal (for opening full page)
     let currentPreviewMarkdown = '';

     document.getElementById('open-full').addEventListener('click', ()=>{
       if(!currentPreviewMarkdown) return;
       openFullPage(currentPreviewMarkdown, document.getElementById('modal-title').textContent || 'Draft');
     });

     function openFullPage(md, title){
       const w = window.open('', '_blank');
       if(!w) return alert('Popup blocked — allow popups for this site to open full page.');
       const doc = w.document;
       const html = `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>${escapeHtml(title)}</title><style>body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Ubuntu,sans-serif;margin:0;padding:28px;background:#fff;color:#0b2540} .container{max-width:900px;margin:24px auto;padding:28px;border-radius:8px;background:#fff;box-shadow:0 6px 30px rgba(11,37,64,0.06)} h1{font-size:2.2rem;margin-top:0} h2{font-size:1.6rem} pre{background:#f6f7f9;padding:12px;border-radius:6px;overflow:auto} code{background:#f3f4f6;padding:2px 6px;border-radius:4px} img{max-width:100%;height:auto;border-radius:6px} a{color:#0b5cff}</style></head><body><div class="container"><h1>${escapeHtml(title)}</h1>` + markdownToHtml(md) + `</div></body></html>`;
       doc.open(); doc.write(html); doc.close();
     }

    function closeModal(){ document.getElementById('modal').classList.remove('open'); }
    document.getElementById('close-modal').addEventListener('click', closeModal);
    document.getElementById('modal').addEventListener('click', (e)=>{ if(e.target.id === 'modal') closeModal(); });

    // Basic markdown renderer (small)
    function markdownToHtml(md){
      if(!md) return '';
      // extract image markdown ![alt](src) into placeholders so they are not escaped
      const images = [];
      md = md.replace(/!\[([^\]]*)\]\(([^)]+)\)/gim, function(m, alt, src){
        const id = '___IMG_' + images.length + '___';
        images.push({ id, alt, src });
        return id;
      });
      let out = escapeHtml(md);
      out = out.replace(/```([\s\S]*?)```/g, function(m, code){ return '<pre><code>' + code.replace(/</g,'&lt;') + '</code></pre>'; });
      out = out.replace(/^###### (.*$)/gim, '<h6>$1</h6>');
      out = out.replace(/^##### (.*$)/gim, '<h5>$1</h5>');
      out = out.replace(/^#### (.*$)/gim, '<h4>$1</h4>');
      out = out.replace(/^### (.*$)/gim, '<h3>$1</h3>');
      out = out.replace(/^## (.*$)/gim, '<h2>$1</h2>');
      out = out.replace(/^# (.*$)/gim, '<h1>$1</h1>');
      out = out.replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>');
      out = out.replace(/\*(.*?)\*/gim, '<em>$1</em>');
      out = out.replace(/`([^`]+)`/gim, '<code>$1</code>');
      out = out.replace(/\[([^\]]+)\]\(([^)]+)\)/gim, '<a href="$2" target="_blank" rel="noopener">$1</a>');
      out = out.replace(/(^|\n)\s*[-*+] (.+)/gim, function(_, pre, item){ return (pre || '\n') + '<li>' + item + '</li>'; });
      out = out.replace(/(?:<li>[\s\S]+?<\/li>)/g, function(match){ return '<ul>' + match + '</ul>'; });
      out = out.replace(/\n{2,}/g, '</p><p>');
      out = '<p>' + out + '</p>';
      out = out.replace(/<p>\s*(<ul>)/g, '$1').replace(/(<\/ul>)\s*<\/p>/g, '$1');
      // restore extracted images (insert raw <img> tags)
      images.forEach(img => {
        // img.src may already be a data: URI or a resolved path
        const safeAlt = escapeHtml(img.alt || '');
        const imgHtml = `<img src="${img.src}" alt="${safeAlt}" />`;
        // replace placeholder id with imgHtml
        out = out.split(img.id).join(imgHtml);
      });
      return out;
    }

    function escapeHtml(str){
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    renderJourney();
    // load latest-updates README into left panel (if available)
     async function loadLatestUpdates(){
      const container = document.querySelector('.news');
      const target = document.createElement('div');
      target.className = 'news-content';
      try{
        const res = await fetch('./year-drafts/latest-updates/README.md');
        if(!res.ok) throw new Error('not found');
        let md = await res.text();
        md = normalizeRelativeLinks(md, './year-drafts/latest-updates');
        target.innerHTML = markdownToHtml(md);
      }catch(e){
        target.innerHTML = '<div style="font-size:0.9rem;color:#9fb0bf">Latest updates unavailable (serve site via HTTP to preview local files)</div>';
      }
      const old = container.querySelector('.news-content');
      if(old) old.remove();
      container.appendChild(target);
    }
    loadLatestUpdates();

    // Helper: rewrite relative image/link paths inside markdown so they resolve correctly when loaded from year-drafts
    function normalizeRelativeLinks(md, basePath){
      if(!md) return md;
      // image or link paths that are relative (do not start with http://, https://, or /)
      // replace patterns like ![alt](assets/x.png) or [text](assets/x.png)
      return md.replace(/(!?\[[^\]]*\]\()(?!(?:https?:|\/))(.*?)\)/g, function(m, p1, p2){
        // if path is absolute-ish or starts with ./ already, leave it
        const trimmed = p2.trim();
        const prefix = basePath.replace(/\/$/, '');
        return p1 + prefix + '/' + trimmed + ')';
      });
    }

    // Note: To publish permanently, add markdown files under /posts and link from this page or convert this into a static site generator flow.
  </script>
</body>
</html>